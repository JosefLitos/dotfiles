#!/usr/bin/bash
#Battery status script
#FontAwesome icons for use
#       ⚡ 
read -a line <<< "$(acpi)"
TEXT=${line[2]:0:1}
STATE=${line[3]%\%*}
TIME=${line[4]%:??}

if [[ -z $TEXT ]]; then
	TEXT=
elif [[ ${line[6]} == zero ]]; then
	TEXT=" $STATE%"
else
	case "$TEXT" in
		'D')
			if ((STATE < 20)); then
				TEXT=
				if ((STATE == 20)); then
					notify-send -t 5000 -u low -h int:value:20 'Battery   20%'
				elif ((14 < STATE && STATE < 17)); then
					notify-send -t 10000 -h int:value:16 "Battery   $STATE%" 'Plug the system in.'
				elif ((9<STATE && STATE < 12)); then
					notify-send -u critical -h int:value:12 "Battery   $STATE%" 'Plug the system in.'
					case "$(rofi -dmenu -l 3 -p "  $STATE%" <<< 'Suspend
Hibernate
Power off')" in
						'Suspend') systemctl suspend ;;
						'Hibernate') { [[ $(swapon --show=NAME) ]] || sudo swapon /swapfile; } &&
							systemctl hibernate && sleep 60 && sudo swapoff /swapfile ;;
						'Power off') systemctl poweroff ;;
					esac
				elif ((STATE < 7)); then
					{ [[ $(swapon --show=NAME) ]] || sudo swapon /swapfile; } && systemctl \
						hibernate && sleep 60 && sudo swapoff /swapfile
				fi
			elif ((STATE < 40)); then
				TEXT=
			elif ((STATE < 60)); then
				TEXT=
			elif ((STATE < 80)); then
				TEXT=
			else
				TEXT=
			fi
			;;
		'C') TEXT= ;;
		'F') TEXT= ;;
		*) TEXT= ;;
	esac
	TEXT="$TEXT $STATE% $TIME"
fi

echo "$TEXT
$TEXT"
~/.config/i3blocks/colorcode $STATE
